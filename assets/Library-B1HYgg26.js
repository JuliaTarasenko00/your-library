import{f as B,g as C,u as P,j as e,b as S,c as f,r as p}from"./index-B5_S-FnD.js";import{F as T,b as q,u as M,B as R}from"./bigBook-ChUp5b0l.js";import{u as L,a as $,C as w,b as K,t as F}from"./toastStyle-DgEY4zav.js";import{T as v}from"./TextInput-BTSYMi3L.js";import{a as D,b as O,s as A,r as G,f as I,C as Q,T as _,L as V}from"./Title-rMoPHFcG.js";import{c as z,a as E,b as H,o as U}from"./index.esm-DzzYa7yZ.js";import{G as Y}from"./iconBase-BLmnM2lr.js";import"./index-BlXa3pRq.js";const J=()=>{const{mutate:r,isPending:t}=L({mutationKey:["add/book_to_library"],mutationFn:o=>D(o)});return{mutate:r,isPending:t}},W=z().shape({title:E().required("Specify a book name"),author:E().required("Specify the author of the book"),totalPages:H().min(1,"The total pages must be greater than or equal to 1.").required("Specify the number of pages")}),X=(r,t)=>{const{data:o}=B({queryKey:["get/books-by-my-library"],queryFn:()=>O(r,t)});return{data:o}},Z={title:"",author:"",totalPages:0},ee=()=>{const r=C(),{data:t}=X(3,3),{mutate:o,isPending:c}=J(),l=P(),{handleSubmit:m,control:n,formState:{errors:i}}=$({defaultValues:Z,mode:"onSubmit",resolver:U(W)}),g=async a=>{o({...a},{onSuccess:async()=>{await r.invalidateQueries({queryKey:["fetch/get_library"]}),f.success("Your book is now in the library!",{style:K})},onError:s=>{f.error(s.response.data.message,{style:F})}})};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"w-full",children:[e.jsx("h2",{className:"mb-[8px] text-[10px] font-medium text-[#F9F9F9] md:text-[14px]",children:"Create your library:"}),e.jsxs("form",{onSubmit:m(g),children:[e.jsxs("div",{className:"mb-[20px] flex flex-col items-center justify-center gap-[8px]",children:[e.jsx(w,{name:"title",control:n,render:({field:a})=>{var s;return e.jsx(v,{...a,errorMessage:(s=i.title)==null?void 0:s.message,label:"Book title:"})}}),e.jsx(w,{name:"author",control:n,render:({field:a})=>{var s;return e.jsx(v,{...a,errorMessage:(s=i.author)==null?void 0:s.message,label:"The author:"})}})," ",e.jsx(w,{name:"totalPages",control:n,render:({field:a})=>{var s;return e.jsx(v,{...a,errorMessage:(s=i.totalPages)==null?void 0:s.message,label:"Number of pages:"})}})]}),e.jsx("button",{type:"submit",className:A,disabled:c,children:"To apply"})]})]}),e.jsxs("div",{className:"mt-[20px] rounded-[12px] bg-[#262626] p-[12px] xs:p-[20px] md:mt-0 lg:mt-[78px]",children:[e.jsx("h3",{className:"mb-[20px] text-[18px] font-medium leading-[20px] text-[#E3E3E3]",children:"Recommended books"}),e.jsx("ul",{className:"flex justify-center gap-[5px] xs:gap-[20px]",children:t==null?void 0:t.results.map(({_id:a,imageUrl:s,title:h,author:y})=>{const j=`${h.slice(0,5)}${h.length>=5?"...":""}`;return e.jsxs("li",{className:"flex w-[71px] flex-col",children:[e.jsx("img",{src:s,alt:h,width:71,height:107,className:"h-[107px] w-[71px] rounded-[8px]"}),e.jsxs("div",{className:"mt-[8px] flex-grow-[1]",children:[e.jsx("h4",{className:"text-[10px] font-bold leading-[12px] text-[#E3E3E3]",children:j}),e.jsx("p",{className:"text-[10px] font-normal leading-[12px] text-[#686868]",children:y})]})]},a)})}),e.jsxs("div",{className:"mt-[20px] flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:()=>l(S.main),className:"text-[14px] leading-[18px] text-[#686868] underline",children:"Home"}),e.jsx("button",{type:"button",onClick:()=>l(S.main),children:e.jsx(T,{})})]})]})]})},te=()=>{const{mutate:r,isPending:t}=L({mutationKey:["remove/book-from-library"],mutationFn:o=>G(o)});return{mutate:r,isPending:t}},se=()=>e.jsxs("div",{className:"flex h-full w-full flex-col items-center justify-start gap-[20px] lg:justify-center",children:[e.jsx("div",{className:"flex h-[100px] w-[100px] items-center justify-center rounded-[65px] bg-[#262626] md:h-[130px] md:w-[130px]",children:e.jsx("img",{src:q,alt:"book",width:70,height:70,className:"h-[50px] w-[50px] md:h-[70px] md:w-[70px]"})}),e.jsxs("p",{className:"max-w-[274px] text-center text-[14px] font-normal leading-[18px] text-[#F9F9F9]",children:["To start training, add"," ",e.jsx("span",{className:"text-[#686868]",children:"some of your books"})," or from the recommended ones"]})]}),re=()=>{const{mutate:r,isPending:t}=L({mutationKey:["filter/filter-my-library"],mutationFn:o=>I(o)});return{mutate:r,isPending:t}};function oe(r){return Y({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0V0z"},child:[]},{tag:"path",attr:{d:"M7.41 8.59 12 13.17l4.59-4.58L18 10l-6 6-6-6 1.41-1.41z"},child:[]}]})(r)}const ae=({options:r,currentOption:t,handleChangeCurrentOption:o})=>{const[c,l]=p.useState(!1),m=p.useRef(null);return p.useEffect(()=>{const n=i=>{if(m.current&&!m.current.contains(i.target)){l(!1);return}};return document.addEventListener("mousedown",n),()=>document.removeEventListener("mousedown",n)},[]),e.jsxs("div",{className:"relative","data-el":"filter-books",ref:m,children:[e.jsxs("button",{onClick:()=>l(!c),type:"button",className:"flex w-[153px] max-w-[153px] items-center justify-between rounded-[12px] border-[1px] border-[#3E3E3E] p-[12px] md:p-[14px]",children:[t," ",e.jsx(oe,{className:`h-[22px] w-[22px] ${c?"rotate-[180deg]":""} transition-custom`})]}),e.jsx("ul",{className:`absolute top-[116%] flex w-full flex-col gap-[7px] overflow-hidden rounded-[12px] bg-[#262626] p-[14px] shadow-lg ${c?"max-h-60 max-w-60 opacity-100":"pointer-events-none max-h-0 opacity-0"} transition-custom`,children:r.map(({type:n,option:i})=>e.jsx("li",{className:` ${t===i?"cursor-default text-[#F9F9F9]":"cursor-pointer text-[#686868]"} transition-custom text-[12px] leading-[18px] md:text-[14px]`,onClick:()=>{o(n,i),l(!1)},children:i},n))})]})},N=[{type:"unread",option:"Unread"},{type:"in-progress",option:"In progress"},{type:"done",option:"Done"},{type:"",option:"All books"}];function pe(){const r=C(),{data:t,isLoading:o}=M();console.log("libraryData: ",t);const{mutate:c,isPending:l}=te(),{mutate:m,isPending:n}=re(),[i,g]=p.useState(N[N.length-1].option),[a,s]=p.useState([]);console.log("bookList: ",a),p.useEffect(()=>{t&&s(t)},[t]);const h=o||l||n,y=(b,k)=>{b.stopPropagation(),c(k,{onSuccess:({id:d})=>{s(x=>x.filter(({_id:u})=>u!==d))},onError:d=>{var x,u;f.error(((u=(x=d.response)==null?void 0:x.data)==null?void 0:u.message)||"Failed to remove book",{style:F})}})},j=async(b,k)=>{if(g(k),b===""){await r.invalidateQueries({queryKey:["fetch/get_library"]}),t&&s(t);return}m(b,{onSuccess:d=>s(d),onError:d=>{var x,u;f.error(((u=(x=d.response)==null?void 0:x.data)==null?void 0:u.message)||"Failed to filter books",{style:F})}})};return e.jsxs(Q,{childrenSecond:e.jsx(ee,{}),children:[e.jsxs("div",{className:"mb-7 flex items-center justify-between",children:[e.jsx(_,{children:"My Library"}),e.jsx(ae,{options:N,currentOption:i,handleChangeCurrentOption:j})]}),h?e.jsx(V,{}):a.length?e.jsx(R,{data:a,onDeleteBookFromLibrary:y}):e.jsx(se,{})]})}export{pe as default};
